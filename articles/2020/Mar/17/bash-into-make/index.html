<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Bash script into a Makefile</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="How to convert a bash script into a Makefile">
<link rel="shortcut icon" href="https://clamytoe.github.io/favicon.ico" type="image/vnd.microsoft.icon">
<meta name="author" content="Martin Uribe">
<meta name="copyright" content="Martin Uribe">
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@clamytoe" />
<meta property="og:site_name" content="Ramblings" />

<meta property="og:title" content="Bash script into a makefile" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make" />
<meta name="twitter:title" content="Bash script into a makefile" />
<meta name="twitter:url" content="https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make" />
<meta itemprop="url" content="https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make" />
<meta property="og:description" content="How to convert a bash script into a Makefile" />
<meta name="twitter:description" content="How to convert a bash script into a Makefile" />
<meta property="og:article:published_time" content="2020-03-17" />
<meta property="og:article:modified_time" content="2020-03-17">
<meta itemprop="dateModified" content="2020-03-17" />
<meta property="og:article:author" content="Martin Uribe" >
<meta property="og:article:tag" content="bash">
<meta property="og:article:tag" content="make">
<meta property="og:article:tag" content="makefile">
<meta property="og:image" content="/img/clamytoe.png" />
<meta property="og:image:type" content="image/png" />
<meta name="twitter:image" content="/img/clamytoe.png" />
<meta itemprop="image" content="/img/clamytoe.png" />

<link href="https://clamytoe.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ramblings ATOM Feed"/>
<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/uikit.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/css/components/search.min.css">
<link rel="stylesheet" href="https://clamytoe.github.io/theme/css/tipuesearch.css">
<link rel="stylesheet" href="https://clamytoe.github.io/theme/css/solarized.css">
<link rel="stylesheet" href="https://clamytoe.github.io/theme/css/main.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

<header class=" mg-header uk-navbar uk-navbar-attached">

    <div class="uk-container uk-container-center">

        <a class="mg-brand uk-navbar-brand uk-hidden-small" href="https://clamytoe.github.io">#! Ramblings</a>
        <div class="mg-tagline uk-navbar-content uk-hidden-small">of an autodidact...</div>
        <a class="uk-navbar-toggle uk-visible-small" href="#mg-offcanvas" data-uk-offcanvas></a>
        <a class="mg-brand uk-navbar-brand uk-navbar-center uk-visible-small" href="https://clamytoe.github.io">#! Ramblings</a>

    </div>
</header>

<main class="mg-main">

<div class="uk-container uk-container-center">

    <div class="uk-grid" data-uk-grid-margin>

<div class="mg-container-social uk-width-medium-1-10 uk-hidden-small">

    <div class="uk-panel" id="mg-panel-social">
        <ul class="uk-nav uk-nav-side">
            <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button"><i class="uk-icon-facebook-square"></i> Share</a>
            </li>
            <li>
            <a href="https://twitter.com/intent/tweet?text=Bash%20script%20into%20a%20Makefile&url=https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make&via=clamytoe" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="uk-button" target="_blank"><i class="uk-icon-twitter"></i> Tweet</a>
            </li>
            <li>
            <a href="https://plus.google.com/share?url=https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank" class="uk-button"><i class="uk-icon-google-plus-square"></i> Share</a>
            </li>
        </ul>
    </div>

</div>

<div class="uk-width-medium-7-10">

    <article class="uk-article">
        <h1 class="uk-heading-large uk-article-title" itemprop="name">Bash script into a Makefile</h1>
        <p class="uk-article-meta"><time datetime="2020-03-17" itemprop="datePublished">Tue 17 March 2020</time> in <a href="https://clamytoe.github.io/category/misc.html">Misc</a><span class="readtime-comment">Estimated read time: <span class="readtime-min">9 min</span></span></p>

        <a href="https://www.facebook.com/sharer/sharer.php?u=https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button uk-visible-small"><i class="uk-icon-facebook-square"></i> Share</a>
        <a href="https://twitter.com/intent/tweet?text=Bash%20script%20into%20a%20Makefile&url=https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make&via=clamytoe" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="uk-button uk-visible-small" target="_blank"><i class="uk-icon-twitter"></i> Tweet</a>
        <a href="https://plus.google.com/share?url=https://clamytoe.github.io/articles/2020/Mar/17/bash-into-make" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank" class="uk-button uk-visible-small"><i class="uk-icon-google-plus-square"></i> Share</a>

        <p class="uk-article-lead" itemprop="description">How to convert a bash script into a Makefile</p>
        <section itemprop="articleBody"><h1>Using make can literally make your life easier</h1>
<p>So the other day on the Pybites slack channel, <a href="https://opensource.com/users/jnyjny">Erik O'Shaughnessy</a> and I were chatting about something and I happened to mention that I had written a bash script to generate documents from Asciidoc files but wanted to create a Makefile to do the same instead.
Without hesitation, he asked for my bash script and got to work!
I don't think that I could have found a better tutorial on the subject if I had looked.
I've looked things up before and nothing is as succinct as what he wrote up for me.</p>
<p>This is all his work and even though I made some changes, the credit for it all goes to him.
I thought it was so great, that I had to share it with everyone because I believe that it can help others get up to speed with creating Makefiles.</p>
<h2>What is a make and what is a Makefile</h2>
<p>The <a href="https://www.gnu.org/software/make/">GNU Make</a> project's page describes it as such:</p>
<blockquote>
<p>GNU Make is a tool which controls the generation of executables and other non-source files of a program from the program's source files.</p>
</blockquote>
<p>It basically means that you can automate some common tasks with it.
To illustrate what it can do, I am going to show you how Erik converted my bash script.</p>
<h2>The bash script</h2>
<p>Here is the script in all its glory...
It's not much.
It was just thrown together pretty quick and it was getting the job done.</p>
<figure class='code'>
<figcaption><span class="liquid-tags-code-filename">gen_book.sh</span></figcaption>

<div class="highlight"><pre><span></span><code><span class="c">#!/bin/bash</span>
<span class="nv">DOC</span><span class="o">=</span><span class="s1">&#39;sop&#39;</span>
<span class="nv">DATE</span><span class="o">=</span><span class="sb">`</span>date +%Y-%m-%d<span class="sb">`</span>
<span class="nv">REV</span><span class="o">=</span><span class="sb">`</span>grep revnumber sop.asc <span class="p">|</span> cut -d <span class="s1">&#39; &#39;</span> -f <span class="m">2</span><span class="sb">`</span>
<span class="nv">PARAMS</span><span class="o">=</span><span class="s2">&quot;--attribute revnumber=</span><span class="nv">$REV</span><span class="s2"> --attribute revdate=</span><span class="nv">$DATE</span><span class="s2">&quot;</span>

<span class="err">echo</span> <span class="s2">&quot;Converting to HTML...&quot;</span>
<span class="err">bundle</span> <span class="err">exec</span> <span class="err">asciidoctor</span> <span class="err">$PARAMS</span> <span class="err">$DOC.asc</span>
<span class="err">echo</span> <span class="s2">&quot; -- HTML outpt at $DOC.html&quot;</span>

<span class="err">echo</span> <span class="s2">&quot;Converting to ePub...&quot;</span>
<span class="err">bundle</span> <span class="err">exec</span> <span class="err">asciidoctor-epub3</span> <span class="err">$PARAMS</span> <span class="err">$DOC.asc</span>
<span class="err">echo</span> <span class="s2">&quot; -- ePub output at $DOC.epub&quot;</span>

<span class="err">echo</span> <span class="s2">&quot;Converting to Mobi (kf8)...&quot;</span>
<span class="err">bundle</span> <span class="err">exec</span> <span class="err">asciidoctor-epub3</span> <span class="err">$PARAMS</span> <span class="err">-a</span> <span class="nv">ebook-format</span><span class="o">=</span>kf8 <span class="nv">$DOC</span>.asc
<span class="err">echo</span> <span class="s2">&quot; -- Mobi output at $DOC.mobi&quot;</span>

<span class="err">echo</span> <span class="s2">&quot;Converting to PDF ... (This one takes a while)&quot;</span>
<span class="err">bundle</span> <span class="err">exec</span> <span class="err">asciidoctor-pdf</span> <span class="err">$PARAMS</span> <span class="err">$DOC.asc</span>
<span class="err">echo</span> <span class="s2">&quot; -- PDF output at $DOC.pdf&quot;</span>
</code></pre></div>


</figure>

<h2>Creating the Makefile</h2>
<h3>Variables</h3>
<p>This is how you assign a string to a variable name in <em>Make</em>.
The variable name doesn't have to be all caps and the equal doesn't have
to be snugged up to the variable name; it's just how I write Makefiles</p>
<div class="highlight"><pre><span></span><code><span class="nv">FILENAME</span><span class="o">=</span> sop
</code></pre></div>


<h3>Referencing variables</h3>
<p><code>$(IDENTIFIER)</code> is how you reference a variable in Make, you can use <code>${}</code> too, but I prefer <code>$()</code>.
If you forget the parentheses or the curly braces, eg <code>$INDENTIFER</code>, Make will interpret that as <code>$I</code> with <code>NDENTFIER</code> appended to it.
Probably not what you are expecting.</p>
<div class="highlight"><pre><span></span><code><span class="nv">SOURCE</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.asc

<span class="nv">HTML</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.html
<span class="nv">PDF</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.pdf
<span class="nv">EPUB</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.epub
<span class="nv">MOBI</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.mobi
</code></pre></div>


<h3>Shell commands</h3>
<p><code>$(shell shell command )</code> is how you invoke a command and save the results to a variable.
It gets kinda tricky since every time you reference <code>$(DATE)</code> it will execute the command.
The weird assignment operator <code>:=</code> means just assign it one time.</p>
<div class="highlight"><pre><span></span><code><span class="nv">DATE</span> <span class="o">:=</span> <span class="k">$(</span>shell date +%Y-%m-%d<span class="k">)</span>
</code></pre></div>


<p>Again, calling shell. This time using <code>AWK</code> to pull out the revision number.</p>
<p>The <em>$</em> needs to be doubled in the command string to keep Make from
trying to expand <code>$2</code> into something we didn't intend.</p>
<p>I know there was a <code>grep</code>|<code>cut</code> in the bash version, I prefer to use <code>awk</code> for these kinds of <em>snip</em> operations since it's a single process invocation.
Those are easier to deal with in this context since you don't have to worry about any pipe weirdness imposed by Make.</p>
<div class="highlight"><pre><span></span><code><span class="nv">REVISION</span> <span class="o">:=</span> <span class="k">$(</span>shell awk <span class="s1">&#39;/revnumber/ {print $$2}&#39;</span> <span class="k">$(</span>SOURCE<span class="k">))</span>
</code></pre></div>


<h3>Functions / macros</h3>
<p>Ok this is a "function" definition that we use to build the various  <code>ASCIIDOCTOR</code> invocations.
We could have just written the format specific definitions:</p>
<div class="highlight"><pre><span></span><code><span class="nv">ADOC_HTML</span><span class="o">=</span> bundle <span class="nb">exec</span> asciidoctor
<span class="nv">ADOC_PDF</span><span class="o">=</span> bundle <span class="nb">exec</span> asiidoctor-pdf
...
</code></pre></div>


<p>The advantage of this technique is you only have to change the <code>BUNDLE_EXEC</code> part if the way you invoke <em>asciidoctor</em> changes (I don't know why it would change, but the idea is to isolate stuff that's repeated so you don't have to freaking change it everywhere).</p>
<p>Macro or <em>function</em> definition</p>
<div class="highlight"><pre><span></span><code><span class="nv">BUNDLE_EXEC</span><span class="o">=</span> bundle <span class="nb">exec</span> <span class="k">$(</span><span class="m">1</span><span class="k">)</span>
</code></pre></div>


<h3>Using the macro</h3>
<div class="highlight"><pre><span></span><code><span class="nv">ASCIIDOCTOR_HTML</span><span class="o">=</span> <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor<span class="k">)</span>
<span class="nv">ASCIIDOCTOR_PDF</span><span class="o">=</span>  <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor-pdf<span class="k">)</span>
<span class="nv">ASCIIDOCTOR_EPUB</span><span class="o">=</span> <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor-epub3<span class="k">)</span>
<span class="nv">ASCIIDOCTOR_MOBI</span><span class="o">=</span> <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor-epub3<span class="k">)</span>
</code></pre></div>


<h3>Shared flags</h3>
<p>Here we build the shared flags used by <em>asciidoctor</em> by all invocations.
I use the <code>+=</code> assignment to show how you can add to a variable after it's initial assignment.</p>
<div class="highlight"><pre><span></span><code><span class="nv">ADOC_FLAGS</span><span class="o">=</span> --attribute <span class="nv">revnumber</span><span class="o">=</span><span class="k">$(</span>REVISION<span class="k">)</span>
<span class="nv">ADOC_FLAGS</span><span class="o">+=</span> --attribute <span class="nv">revdate</span><span class="o">=</span><span class="k">$(</span>DATE<span class="k">)</span>
</code></pre></div>


<h3>Default rule</h3>
<p>The default rule that <em>Make</em> looks for when invoked as <code>make</code> is <code>all</code>.
To build the <code>all</code> target, <em>make</em> builds, replace all with "a rule" name.</p>
<div class="highlight"><pre><span></span><code><span class="nf">rulename</span><span class="o">:</span> <span class="n">dep</span>1 <span class="n">dep</span>2 <span class="n">dep</span>3 ... <span class="n">depN</span>
<span class="err">command_0</span>
<span class="err">@command_1</span>
<span class="err">...</span>
<span class="err">comand_n</span>

<span class="nf">dep1</span><span class="o">:</span> <span class="n">subdep</span>1 ...
</code></pre></div>


<p>Here, the dependencies for <code>all</code> are <code>$(HTML)</code>, <code>$(PDF)</code>, <code>$(EPUB)</code> and <code>$(MOBI)</code> which expand in to the names of the files that <em>asciidoctor</em> will create.
So <code>make all</code> will run the <em>HTML</em>, <em>PDF</em>, <em>EPUB</em> and <em>MOBI</em> rules in that order.</p>
<div class="highlight"><pre><span></span><code><span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">HTML</span><span class="k">)</span> <span class="k">$(</span><span class="nv">PDF</span><span class="k">)</span> <span class="k">$(</span><span class="nv">EPUB</span><span class="k">)</span> <span class="k">$(</span><span class="nv">MOBI</span><span class="k">)</span>
</code></pre></div>


<h3>Rules</h3>
<p>The <code>$(HTML)</code> rule depends on <code>$(SOURCE)</code>, and only executes if the source file has changed or the destination file does not exist.
<code>$@</code> is an alias for the name of the rule to be used in the body of the recipe.</p>
<p>By default, <em>make</em> will print the command that is being executed to stdout followed by it's output.
To suppress printing the command, preface the command with an <code>@</code>.</p>
<p>Lastly, the indention is a <strong>TAB</strong> and not <strong>8 spaces</strong>.
<em>Make</em> is an old-school tool and will complain if it doesn't get it's tabs.</p>
<div class="highlight"><pre><span></span><code><span class="nf">$(HTML)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="nv">$@</span>
    @<span class="k">$(</span>ASCIIDOCTOR_HTML<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">$(PDF)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="nv">$@</span>
    @<span class="k">$(</span>ASCIIDOCTOR_PDF<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">$(EPUB)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="nv">$@</span>
    @<span class="k">$(</span>ASCIIDOCTOR_EPUB<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">$(MOBI)</span><span class="o">:</span> <span class="n">ADOC_FLAGS</span> += -<span class="n">a</span> <span class="n">ebook</span>-<span class="n">format</span>=<span class="n">kf</span>8
<span class="nf">$(MOBI)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="nv">$@</span>
    @<span class="k">$(</span>ASCIIDOCTOR_MOBI<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>
</code></pre></div>


<h3>The debug rule</h3>
<p>The debug rule is how I checked to make sure all of the variables I constructed contained the things I thought they should.</p>
<div class="highlight"><pre><span></span><code><span class="nf">debug</span><span class="o">:</span>
    @echo Rule -&gt; <span class="nv">$@</span>
    @echo <span class="s1">&#39;          SOURCE: $(SOURCE)&#39;</span>
    @echo <span class="s1">&#39;        REVISION: $(REVISION)&#39;</span>
    @echo <span class="s1">&#39;            HTML: $(HTML)&#39;</span>
    @echo <span class="s1">&#39;             PDF: $(PDF)&#39;</span>
    @echo <span class="s1">&#39;            EPUB: $(EPUB)&#39;</span>
    @echo <span class="s1">&#39;            MOBI: $(MOBI)&#39;</span>
    @echo <span class="s1">&#39;       DOC_FLAGS: $(ADOC_FLAGS)&#39;</span>
    @echo <span class="s1">&#39;ASCIIDOCTOR HTML: $(ASCIIDOCTOR_HTML)&#39;</span>
    @echo <span class="s1">&#39; ASCIIDOCTOR PDF: $(ASCIIDOCTOR_PDF)&#39;</span>
    @echo <span class="s1">&#39;ASCIIDOCTOR EPUB: $(ASCIIDOCTOR_EPUB)&#39;</span>
    @echo <span class="s1">&#39;ASCIIDOCTOR MOBI: $(ASCIIDOCTOR_MOBI)&#39;</span>
</code></pre></div>


<h3>The clean rule</h3>
<p>Often times we want to restart from a known good "clean" state.
A clean rule is a good place to remove transient files so you ensure that all your dependencies in your project are rebuilt.
In this case we just remove the translated files.
We could use wildcards in this rule like <code>rm *.html</code> but this can have unintended consequences if we have other files in HTML format that we didn't want to smoke.</p>
<p>Always be as explicit as possible in clean rules.</p>
<div class="highlight"><pre><span></span><code><span class="nf">clean</span><span class="o">:</span>
    @/bin/rm -f <span class="k">$(</span>HTML<span class="k">)</span> <span class="k">$(</span>PDF<span class="k">)</span> <span class="k">$(</span>EPUB<span class="k">)</span> <span class="k">$(</span>MOBI<span class="k">)</span>
</code></pre></div>


<h2>Modifications and additions that I made</h2>
<p>I'm lazy.
I didn't want to have to type out <code>make sop.pdf</code> each time that I wanted to generate my document in the pdf format.
So I changed a few things around.</p>
<h3>Default rule modifications</h3>
<div class="highlight"><pre><span></span><code><span class="nf">all</span><span class="o">:</span> <span class="n">html</span> <span class="n">pdf</span> <span class="n">epub</span> <span class="n">mobi</span>
</code></pre></div>


<h3>Rules modifications</h3>
<div class="highlight"><pre><span></span><code><span class="nf">html</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>HTML<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_HTML<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">pdf</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>PDF<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_PDF<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">epub</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>EPUB<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_EPUB<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">mobi</span><span class="o">:</span> <span class="n">ADOC_FLAGS</span> += -<span class="n">a</span> <span class="n">ebook</span>-<span class="n">format</span>=<span class="n">kf</span>8
<span class="nf">mobi</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>MOBI<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_MOBI<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>
</code></pre></div>


<p>With those changes I can now recreate any of those formats by simply specifying them, as so: <code>make pdf</code></p>
<h3>The help rule</h3>
<p>I also added a help rule.
I've found it to be very useful for letting users know what commands are available and what they do.
Mostly it's for me, I forget everything...</p>
<div class="highlight"><pre><span></span><code><span class="nf">help</span><span class="o">:</span>
    @echo <span class="s1">&#39;Makefile for generating documents from Asciidoc source files              &#39;</span>
    @echo <span class="s1">&#39;                                                                          &#39;</span>
    @echo <span class="s1">&#39;Usage:                                                                    &#39;</span>
    @echo <span class="s1">&#39;   make help                           prints this message                &#39;</span>
    @echo <span class="s1">&#39;   make all                            generates all of the formats       &#39;</span>
    @echo <span class="s1">&#39;   make clean                          remove the generated file formats  &#39;</span>
    @echo <span class="s1">&#39;   make debug                          prints all of the variables used   &#39;</span>
    @echo <span class="s1">&#39;   make html                           (re)generates an html file         &#39;</span>
    @echo <span class="s1">&#39;   make pdf                            (re)generates a pdf file           &#39;</span>
    @echo <span class="s1">&#39;   make epub                           (re)generates an epub file         &#39;</span>
    @echo <span class="s1">&#39;   make mobi                           (re)generates a mobi file          &#39;</span>
    @echo <span class="s1">&#39;   make -n                             prints the commands without        &#39;</span>
    @echo <span class="s1">&#39;                                       executing them                     &#39;</span>
    @echo <span class="s1">&#39;                                                                          &#39;</span>
</code></pre></div>


<h2>Conclusion</h2>
<p><em>Make</em> is a very versatile program and can be used for many more things.
For instance Erik uses it to launch his kids Minecraft server!
Now that I know how a <em>Makefile</em> is constructed, I will be able to automate other parts of my daily tasks!</p>
<p>The <em>MOBI</em> format kept failing on me.
It would leave behind a file with the extension <em>-kf8.epub</em> and never generate the <em>.mobi</em> one.
My guess is that I need to install some kind of Amazon Kindle app or something, so I removed it from the <code>all</code> rule to prevent it from generating by default.</p>
<p>This is the final file:</p>
<div class="highlight"><pre><span></span><code><span class="c"># Makefile</span>

<span class="c"># Main project file name</span>
<span class="nv">FILENAME</span><span class="o">=</span> pnc-sop

<span class="c"># Variables used</span>
<span class="nv">SOURCE</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.asc

<span class="nv">HTML</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.html
<span class="nv">PDF</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.pdf
<span class="nv">EPUB</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.epub
<span class="nv">MOBI</span><span class="o">=</span> <span class="k">$(</span>FILENAME<span class="k">)</span>.mobi

<span class="c"># Store the current date</span>
<span class="nv">DATE</span> <span class="o">:=</span> <span class="k">$(</span>shell date +%Y-%m-%d<span class="k">)</span>

<span class="c"># Grab revision number from the source document</span>
<span class="nv">REVISION</span> <span class="o">:=</span> <span class="k">$(</span>shell awk <span class="s1">&#39;/revnumber/ {print $$2}&#39;</span> <span class="k">$(</span>SOURCE<span class="k">))</span>

<span class="c"># Macro or &#39;function&#39; definition</span>
<span class="nv">BUNDLE_EXEC</span><span class="o">=</span> bundle <span class="nb">exec</span> <span class="k">$(</span><span class="m">1</span><span class="k">)</span>

<span class="c"># Assigning the macro</span>
<span class="nv">ASCIIDOCTOR_HTML</span><span class="o">=</span> <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor<span class="k">)</span>
<span class="nv">ASCIIDOCTOR_PDF</span><span class="o">=</span>  <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor-pdf<span class="k">)</span>
<span class="nv">ASCIIDOCTOR_EPUB</span><span class="o">=</span> <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor-epub3<span class="k">)</span>
<span class="nv">ASCIIDOCTOR_MOBI</span><span class="o">=</span> <span class="k">$(</span>call BUNDLE_EXEC,asciidoctor-epub3<span class="k">)</span>

<span class="c"># Shared flags</span>
<span class="nv">ADOC_FLAGS</span><span class="o">=</span> --attribute <span class="nv">revnumber</span><span class="o">=</span><span class="k">$(</span>REVISION<span class="k">)</span>
<span class="nv">ADOC_FLAGS</span><span class="o">+=</span> --attribute <span class="nv">revdate</span><span class="o">=</span><span class="k">$(</span>DATE<span class="k">)</span>

<span class="c"># Define the make commands</span>
<span class="nf">all</span><span class="o">:</span> <span class="n">html</span> <span class="n">pdf</span> <span class="n">epub</span>

<span class="c"># Define each of the commands and specifying their outputs</span>
<span class="nf">html</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>HTML<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_HTML<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">pdf</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>PDF<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_PDF<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">epub</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>EPUB<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_EPUB<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="nf">mobi</span><span class="o">:</span> <span class="n">ADOC_FLAGS</span> += -<span class="n">a</span> <span class="n">ebook</span>-<span class="n">format</span>=<span class="n">kf</span>8
<span class="nf">mobi</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCE</span><span class="k">)</span>
    @echo Converting <span class="k">$(</span>SOURCE<span class="k">)</span> to <span class="k">$(</span>MOBI<span class="k">)</span>
    @<span class="k">$(</span>ASCIIDOCTOR_MOBI<span class="k">)</span> <span class="k">$(</span>ADOC_FLAGS<span class="k">)</span> <span class="k">$(</span>SOURCE<span class="k">)</span>

<span class="c"># Use debug rule to check that all of the variables were</span>
<span class="c"># constructed properly.</span>
<span class="nf">debug</span><span class="o">:</span>
    @echo Rule -&gt; <span class="nv">$@</span>
    @echo <span class="s1">&#39;          SOURCE: $(SOURCE)&#39;</span>
    @echo <span class="s1">&#39;        REVISION: $(REVISION)&#39;</span>
    @echo <span class="s1">&#39;            HTML: $(HTML)&#39;</span>
    @echo <span class="s1">&#39;             PDF: $(PDF)&#39;</span>
    @echo <span class="s1">&#39;            EPUB: $(EPUB)&#39;</span>
    @echo <span class="s1">&#39;            MOBI: $(MOBI)&#39;</span>
    @echo <span class="s1">&#39;       DOC_FLAGS: $(ADOC_FLAGS)&#39;</span>
    @echo <span class="s1">&#39;ASCIIDOCTOR HTML: $(ASCIIDOCTOR_HTML)&#39;</span>
    @echo <span class="s1">&#39; ASCIIDOCTOR PDF: $(ASCIIDOCTOR_PDF)&#39;</span>
    @echo <span class="s1">&#39;ASCIIDOCTOR MOBI: $(ASCIIDOCTOR_MOBI)&#39;</span>
    @echo <span class="s1">&#39;ASCIIDOCTOR EPUB: $(ASCIIDOCTOR_EPUB)&#39;</span>

<span class="c"># Simple help menu showing what commands are available</span>
<span class="c"># and what they do.</span>
<span class="nf">help</span><span class="o">:</span>
    @echo <span class="s1">&#39;Makefile for generating documents from Asciidoc source files              &#39;</span>
    @echo <span class="s1">&#39;                                                                          &#39;</span>
    @echo <span class="s1">&#39;Usage:                                                                    &#39;</span>
    @echo <span class="s1">&#39;   make help                           prints this message                &#39;</span>
    @echo <span class="s1">&#39;   make all                            generates all of the file formats  &#39;</span>
    @echo <span class="s1">&#39;   make clean                          remove the generated files         &#39;</span>
    @echo <span class="s1">&#39;   make debug                          prints all of the variables used   &#39;</span>
    @echo <span class="s1">&#39;   make html                           (re)generates an html file         &#39;</span>
    @echo <span class="s1">&#39;   make pdf                            (re)generates a pdf file           &#39;</span>
    @echo <span class="s1">&#39;   make epub                           (re)generates an epub file         &#39;</span>
    @echo <span class="s1">&#39;   make mobi                           (re)generates a mobi file          &#39;</span>
    @echo <span class="s1">&#39;   make -n                             prints the commands without        &#39;</span>
    @echo <span class="s1">&#39;                                       executing them                     &#39;</span>
    @echo <span class="s1">&#39;                                                                          &#39;</span>

<span class="c"># Specify clean-up rules.</span>
<span class="nf">clean</span><span class="o">:</span>
    @/bin/rm -f <span class="k">$(</span>HTML<span class="k">)</span> <span class="k">$(</span>PDF<span class="k">)</span> <span class="k">$(</span>EPUB<span class="k">)</span> <span class="k">$(</span>MOBI<span class="k">)</span> <span class="k">$(</span>FILENAME<span class="k">)</span>-kf8.epub
</code></pre></div>


<blockquote>
<p>Thanks again Erik!</p>
</blockquote></section>
        <hr class="uk-article-divider">
    </article>


</div>

        <div class="uk-width-medium-1-5 uk-hidden-small">

            <div class="uk-panel uk-panel-box">
                <form class="uk-search" action="https://clamytoe.github.io/search.html" data-uk-search>
                    <input class="uk-search-field tipue_search" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
                </form>
            </div>

            <div class="uk-panel uk-panel-box">
                <ul class="uk-nav uk-nav-side">
                    <li class="uk-nav-header">Categories</li>
                    <li ><a href="https://clamytoe.github.io/category/blog.html">Blog</a></li>
                    <li ><a href="https://clamytoe.github.io/category/database.html">Database</a></li>
                    <li ><a href="https://clamytoe.github.io/category/datascience.html">DataScience</a></li>
                    <li class="uk-active"><a href="https://clamytoe.github.io/category/misc.html">Misc</a></li>
                    <li ><a href="https://clamytoe.github.io/category/python.html">Python</a></li>
                    <li class="uk-nav-header">Pages</li>

                    <li >
                        <a href="https://clamytoe.github.io/pages/about">About</a>
                    </li>


                    <li class="uk-nav-divider"></li>
                    <li ><a href="https://clamytoe.github.io/archives.html">Archives</a></li>
                </ul>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Receive Updates</h3>
                <a rel="alternate" type="application/atom+xml" href="https://clamytoe.github.io/feeds/all.atom.xml" class="mg-feed"><i class="uk-icon-rss uk-icon-medium"></i> ATOM</a>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Contacts</h3>
                <a class="mg-icon-link" href="https://twitter.com/clamytoe">
                    <i class="uk-icon-twitter uk-icon-medium"></i>
                </a>
                <a class="mg-icon-link" href="https://github.com/clamytoe">
                    <i class="uk-icon-github uk-icon-medium"></i>
                </a>
                <a class="mg-icon-link" href="https://www.linkedin.com/in/martin-uribe/">
                    <i class="uk-icon-linkedin uk-icon-medium"></i>
                </a>
            </div>

        </div>

    </div>

</div>

</main>

<footer class="mg-footer">
    <div class="uk-container uk-container-center uk-text-center">

        <div class="mg-icons-small uk-subnav uk-visible-small">
            <li><a rel="alternate" type="application/atom+xml" href="https://clamytoe.github.io/feeds/all.atom.xml" class="uk-icon-button uk-icon-rss"></a></li>
            <li>
                <a href="https://twitter.com/clamytoe" class="uk-icon-button uk-icon-twitter"></a>
            </li>
            <li>
                <a href="https://github.com/clamytoe" class="uk-icon-button uk-icon-github"></a>
            </li>
            <li>
                <a href="https://www.linkedin.com/in/martin-uribe/" class="uk-icon-button uk-icon-linkedin"></a>
            </li>
        </div>

        <div class="mg-author uk-panel">
            <p>&copy; 2020 Martin Uribe. All rights reserved.<br>Code snippets in the pages are released under <a href="http://opensource.org/licenses/MIT" target="_blank">The MIT License</a>, unless otherwise specified.</p>

            <p>Powered by <a href="http://blog.getpelican.com">Pelican</a>.<br class="uk-visible-small"> Theme based on <a href="https://github.com/lucachr/pelican-mg">mg</a> by <a href="https://github.com/lucachr">Luca Chiricozzi</a>.</p>
        </div>
    </div>
</footer>

<div id="mg-offcanvas" class="uk-offcanvas">
    <div class="uk-offcanvas-bar">

        <form class="uk-search" action="https://clamytoe.github.io/search.html" data-uk-search>
            <input class="uk-search-field" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
        </form>

        <ul class="uk-nav uk-nav-offcanvas" data-uk-nav>
            <li class="uk-nav-header">Categories</li>
            <li ><a href="https://clamytoe.github.io/category/blog.html">Blog</a></li>
            <li ><a href="https://clamytoe.github.io/category/database.html">Database</a></li>
            <li ><a href="https://clamytoe.github.io/category/datascience.html">DataScience</a></li>
            <li class="uk-active"><a href="https://clamytoe.github.io/category/misc.html">Misc</a></li>
            <li ><a href="https://clamytoe.github.io/category/python.html">Python</a></li>
            <li class="uk-nav-header">Pages</li>
            <li >
                <a href="https://clamytoe.github.io/pages/about">About</a>
            </li>


            <li class="uk-nav-divider"></li>
            <li><a href="https://clamytoe.github.io/">Archives</a></li>
        </ul>
    </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/uikit.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.23.0/js/components/search.min.js"></script>
<script src="https://clamytoe.github.io/theme/js/tipuesearch_set.js"></script>
<script src="https://clamytoe.github.io/theme/js/tipuesearch.js"></script>
<script src="https://clamytoe.github.io/theme/js/jquery.sticky-kit.js"></script>
<script src="https://clamytoe.github.io/theme/js/plugins.js"></script>
<script src="https://clamytoe.github.io/theme/js/main-search.js"></script>



</body>
</html>
